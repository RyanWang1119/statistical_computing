---
title: "week2"
author: "Ryan Wang"
date: "2024-09-03"
output:
  html_document:
    citation_package: bibtex
  pdf_document: default
bibliography: "my-refs.bib"
---

```{r setup, include=FALSE}
knitr::write_bib("rmarkdown", file = "my-refs.bib")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
```

## Citation

I have been using the amazing Rmarkdown package [@R-rmarkdown]! I should also go and read [@rmarkdown2018; @rmarkdown2018] books.

## Find and create files
```{r}
library(here)
file.exists(here("lecture", "week2_1.Rmd"))  # logical test if the file exists
# dir.create(here("my", "relative", "path"))  # create a folder
# list.files(here("my", "relative", "path"))  # list contents of folder
# file.create(here("my", "relative", "path"))  # create a file
# file.remove(here("my", "relative", "path"))  #delete a file
```

## R code
```{r}
# source(here::here("functions.R"))
```
To read in the R script file.

## R objects
```{r}
x <- c(1,2,3)
saveRDS(x, file = here("data", "x.Rda"))

new_x1 <- readRDS(here("data", "x.Rda"))
new_x1

new_x2 <- load(here("data", "x.Rda"))
new_x2
```
.RData, .Rda: Stores multiple R objects
.Rds: Stores a single R object

## tibble
```{r}
chicago <- readRDS(here("data", "chicago.rds"))
dim(chicago)
str(chicago)
str(as_tibble(chicago))
as_tibble(chicago) %>%
    print(n = 5, width = Inf)
```

### tibble can use unusual variable names

```{r}
tibble(
    `two words` = 1:5,
    `12` = "numeric",
    `:)` = "smile",
)
```

### Subsetting tibbles
```{r}
df <- tibble(
    a = 1:5,
    b = 6:10,
    c = 1,
    z = (a + b)^2 + c
)

# Extract by name using $ or [[]]
df$z
df[["z"]]
df[[4]]
```

## dplyr
1. The first argument is a data frame type object.

2. The subsequent arguments describe what to do with the data.

3. Returns a new data frame.

### select
 select columns of a data frame
```{r}
subset <- select(chicago, city:dptp)
head(subset)

subset <- select(chicago, -(city:dptp))  # omit data

subset <- select(chicago, ends_with("2"))  # ends_with and start_with
str(subset)
```

### filter
 extract subsets of rows 
```{r}
chic.f <- filter(chicago, pm25tmean2 > 30 & tmpd > 80)
select(chic.f, date, tmpd, pm25tmean2)
```

### arrange
 reorder rows according to one of the variables
```{r}
chicago <- arrange(chicago, date)
head(select(chicago, date, pm25tmean2), 3)
tail(select(chicago, date, pm25tmean2), 3)

chicago <- arrange(chicago, desc(date))
head(select(chicago, date, pm25tmean2), 3)
tail(select(chicago, date, pm25tmean2), 3)
```
 
### rename
 new name on the left-hand side of the = sign and the old name on the right-hand side.
```{r}
chicago <- rename(chicago, dewpoint = dptp, pm25 = pm25tmean2)
head(chicago[, 1:5], 3)
```

### mutate
 compute transformations of variables.
 transmute() drops all non-transformed variables.
```{r}
chicago <- mutate(chicago, pm25detrend = pm25 - mean(pm25, na.rm = TRUE))
head(chicago)

head(transmute(chicago,
    pm10detrend = pm10tmean2 - mean(pm10tmean2, na.rm = TRUE),
    o3detrend = o3tmean2 - mean(o3tmean2, na.rm = TRUE)
))
```

### group_by + summarize
```{r}
chicago <- mutate(chicago, year = as.POSIXlt(date)$year + 1900)
years <- group_by(chicago, year)

summary_df <- summarize(years,
    pm25 = mean(pm25, na.rm = TRUE),
    o3 = max(o3tmean2, na.rm = TRUE),
    no2 = median(no2tmean2, na.rm = TRUE)
)

summary_df <- mutate(chicago, year = as.POSIXlt(date)$year + 1900) %>%
  group_by(year) %>% summarize(
    pm25 = mean(pm25, na.rm = TRUE),
    o3 = max(o3tmean2, na.rm = TRUE),
    no2 = median(no2tmean2, na.rm = TRUE))
```

### slice_*() 
 a sample of rows
```{r}
slice_sample(chicago, n = 10)
slice_head(chicago, n = 5)
```


